---
phase: 09-visual-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/game/utils/paperArt.ts
  - src/game/config/paletteConfig.ts
autonomous: true

must_haves:
  truths:
    - "A shared color palette config exists with all Paper Mario Protest colors"
    - "A paperArt utility module provides: drawPaperCutoutShadow, drawScissorCutEdge, applyPaperGrain, drawPopsicleStick functions"
    - "Drop shadows are hard-offset (2-3px right, 2-3px down, dark, no blur) matching paper-on-table aesthetic"
    - "Scissor-cut edge function produces slightly imperfect outlines via small random vertex offsets on polygons"
    - "Paper grain overlay function draws low-opacity fiber texture onto a Phaser Graphics object"
  artifacts:
    - path: "src/game/config/paletteConfig.ts"
      provides: "Paper Mario Protest color palette constants"
      min_lines: 25
    - path: "src/game/utils/paperArt.ts"
      provides: "Shared procedural paper cutout drawing utilities for all game visuals"
      min_lines: 120
  key_links:
    - from: "src/game/utils/paperArt.ts"
      to: "src/game/config/paletteConfig.ts"
      via: "Art utilities reference palette colors for shadows, outlines, paper tones"
      pattern: "import.*paletteConfig|PALETTE"
---

<objective>
Create the Paper Mario Protest art foundation: a shared color palette config and a procedural drawing utility module that all other Phase 9 plans will import.

Purpose: Every visual upgrade in Phase 9 needs consistent paper cutout aesthetics — hard drop shadows, scissor-cut edges, paper grain textures, popsicle stick mounts. Building these as shared utilities prevents code duplication and ensures visual consistency.

Output: Two new files that provide the art foundation for the entire visual polish phase.
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phase-9-design-direction.md
@mockups/paper-mario-style.html
@src/game/scenes/IntersectionScene.ts
@src/game/entities/Car.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Paper Mario Protest color palette config</name>
  <files>
    src/game/config/paletteConfig.ts
  </files>
  <action>
Create `src/game/config/paletteConfig.ts` with the locked color palette from the design spec:

```typescript
/** Paper Mario Protest — Color Palette
 *  Locked 2026-02-14. All Phase 9 visuals reference this palette.
 */
export const PALETTE = {
  // Core scene colors
  asphalt:       0x3a3a3a,  // Road, dark backgrounds
  cardboard:     0xc5a059,  // UI panels, sign materials
  paperWhite:    0xf5f0e8,  // Light surfaces, paper
  markerBlack:   0x1a1a1a,  // Outlines, text shadows

  // Traffic light / feedback
  safetyYellow:  0xfbbf24,  // Score, highlights, traffic light
  stoplightRed:  0xef4444,  // Danger, fatigue, negative reactions
  stoplightGreen:0x22c55e,  // Go, positive reactions, confidence

  // Interactive
  actionBlue:    0x3b82f6,  // Buttons, CTAs, interactive elements
  craftBrown:    0x92400e,  // Popsicle sticks, sign poles

  // Environment
  grassGreen:    0x6b8f5e,  // Construction paper grass (muted, not digital)
  sidewalkTan:   0xd4b896,  // Construction paper sidewalk
  skyBlue:       0xa8c8e8,  // Background sky (muted, papery)

  // Paper shadow (used by all cutout shadows)
  shadowDark:    0x2a2a2a,  // Hard offset shadow color
  shadowAlpha:   0.35,      // Shadow opacity

  // Drop shadow offsets (pixels)
  shadowOffsetX: 3,
  shadowOffsetY: 3,
} as const;

// Construction paper car colors (warm, muted — not digital-bright)
export const CAR_PAPER_COLORS = [
  0xc0392b,  // construction paper red
  0x2980b9,  // construction paper blue
  0x27ae60,  // construction paper green
  0xf39c12,  // construction paper yellow/orange
  0x8e44ad,  // construction paper purple
  0xe67e22,  // construction paper orange
  0x7f8c8d,  // construction paper gray
  0xecf0f1,  // construction paper white
  0x2c3e50,  // construction paper dark blue
  0x16a085,  // construction paper teal
] as const;
```

Export `PALETTE` and `CAR_PAPER_COLORS` as the canonical color sources. These replace the ad-hoc hex values scattered across the codebase.
  </action>
  <verify>
`npm run build` succeeds. `PALETTE` and `CAR_PAPER_COLORS` are importable from `../config/paletteConfig`.
  </verify>
  <done>
Palette config exists with all Paper Mario Protest colors. Car colors are warm/muted construction paper tones.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create paper cutout drawing utilities</name>
  <files>
    src/game/utils/paperArt.ts
  </files>
  <action>
Create `src/game/utils/paperArt.ts` — shared procedural drawing utilities for the paper cutout aesthetic:

**`drawPaperShadow(g: Phaser.GameObjects.Graphics, x: number, y: number, width: number, height: number, offsetX?: number, offsetY?: number): void`**
- Draw a filled rectangle at (x + offsetX, y + offsetY) with `PALETTE.shadowDark` at `PALETTE.shadowAlpha`
- Defaults: offsetX = PALETTE.shadowOffsetX, offsetY = PALETTE.shadowOffsetY
- This creates the "paper lifted off the table" look — no blur, hard offset

**`drawPaperShadowCircle(g: Phaser.GameObjects.Graphics, x: number, y: number, radius: number): void`**
- Same as above but for circular cutouts

**`drawScissorCutRect(g: Phaser.GameObjects.Graphics, x: number, y: number, width: number, height: number, fillColor: number, strokeColor?: number): void`**
- Draw a rectangle with slightly wobbly edges (not perfectly straight)
- Generate 4 corner points, then add 2-3 intermediate points per edge
- Each intermediate point is offset perpendicular to the edge by a random amount (-1.5 to +1.5 pixels)
- Fill with fillColor, stroke with strokeColor (default PALETTE.markerBlack) at lineWidth 2
- This creates the scissor-cut imperfect edge look

**`drawScissorCutPolygon(g: Phaser.GameObjects.Graphics, points: {x: number, y: number}[], fillColor: number, strokeColor?: number): void`**
- General version: takes arbitrary polygon points, adds wobble between each pair
- Used for car shapes, character shapes, etc.

**`applyPaperGrain(scene: Phaser.Scene, x: number, y: number, width: number, height: number, alpha?: number): Phaser.GameObjects.Graphics`**
- Create a Graphics object with low-opacity (default 0.04) random short lines and dots
- Simulates cardboard fiber grain texture
- Returns the graphics object so caller can set depth/position

**`drawPopsicleStick(g: Phaser.GameObjects.Graphics, x: number, y: number, width: number, height: number): void`**
- Draw a rounded rectangle in PALETTE.craftBrown with slightly darker stroke
- Add 2-3 subtle horizontal grain lines (lighter brown, low alpha)
- Used for traffic light poles, sign posts, clock mounts

**`drawMaskingTapeStrip(g: Phaser.GameObjects.Graphics, x1: number, y1: number, x2: number, y2: number, tapeWidth?: number): void`**
- Draw a slightly off-white semi-transparent strip between two points
- Edges are slightly ragged (small random offsets like scissor cut)
- Default tapeWidth = 8
- Used for lane markings instead of painted lines

**`wobbleSine(baseValue: number, time: number, amplitude?: number, frequency?: number): number`**
- Returns baseValue + sin(time * frequency) * amplitude
- Default amplitude = 1.5 degrees, frequency = 0.002
- Used for idle paper wobble animation on objects

All functions are pure utility — they draw onto provided Graphics objects. No scene management, no state. Import PALETTE from paletteConfig.
  </action>
  <verify>
`npm run build` succeeds. All exported functions are importable. Functions accept Phaser.GameObjects.Graphics parameters.
  </verify>
  <done>
paperArt.ts provides drawPaperShadow, drawScissorCutRect, drawScissorCutPolygon, applyPaperGrain, drawPopsicleStick, drawMaskingTapeStrip, wobbleSine. All reference PALETTE colors.
  </done>
</task>

</tasks>

<verification>
- paletteConfig.ts exports PALETTE object with all 13+ named colors from the design spec
- paletteConfig.ts exports CAR_PAPER_COLORS array with 10 muted construction paper car colors
- paperArt.ts exports at least 7 drawing utility functions
- All functions reference PALETTE colors (no hardcoded hex values in paperArt.ts)
- drawScissorCutRect produces visibly imperfect edges (random offsets on vertices)
- drawPaperShadow produces hard-offset shadows (no blur, dark, 3px offset)
- No TypeScript errors, build succeeds
</verification>

<success_criteria>
A shared art foundation exists that all subsequent Phase 9 plans can import for consistent Paper Mario Protest aesthetics.
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-ui-polish/09-01-SUMMARY.md`
</output>
