---
phase: 09-visual-ui-polish
plan: 02
type: execute
wave: 1
depends_on: ["09-01"]
files_modified:
  - src/game/entities/Car.ts
autonomous: true

must_haves:
  truths:
    - "Cars render as top-down paper cutout shapes instead of colored rectangles"
    - "At least 4 car types exist: sedan (common), SUV, pickup truck, lifted truck"
    - "Each car type has a distinct silhouette drawn procedurally via Phaser Graphics"
    - "Car type is randomly assigned on spawn with weighted probability (sedan most common, lifted truck rare)"
    - "Cars use construction paper color palette from paletteConfig"
    - "Each car has a hard-offset drop shadow underneath (paper-on-table effect)"
    - "Cars have scissor-cut imperfect outlines"
    - "Lifted trucks correlate with higher negative reaction probability (exposed via public property)"
  artifacts:
    - path: "src/game/entities/Car.ts"
      provides: "Paper cutout car entity with 4 types, procedural shapes, drop shadows"
  key_links:
    - from: "src/game/entities/Car.ts"
      to: "src/game/utils/paperArt.ts"
      via: "Uses drawPaperShadow, drawScissorCutPolygon for paper cutout rendering"
      pattern: "import.*paperArt|drawPaperShadow|drawScissorCutPolygon"
    - from: "src/game/entities/Car.ts"
      to: "src/game/config/paletteConfig.ts"
      via: "Uses CAR_PAPER_COLORS and PALETTE for consistent paper colors"
      pattern: "import.*paletteConfig|CAR_PAPER_COLORS|PALETTE"
---

<objective>
Replace the colored rectangle cars with paper cutout top-down car shapes. This is the highest visual impact upgrade ‚Äî cars are the most visible moving objects.

Purpose: Cars are currently plain rectangles with a windshield rectangle. Upgrading to shaped paper cutouts with variety (sedan, SUV, pickup, lifted truck) transforms the visual character of the game.

Output: Car.ts rewritten to render procedural paper cutout shapes with type variety, construction paper colors, and drop shadows.
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phase-9-design-direction.md
@mockups/paper-mario-style.html
@src/game/entities/Car.ts
@src/game/config/intersectionConfig.ts
@src/game/scenes/IntersectionScene.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Car entity with paper cutout car types</name>
  <files>
    src/game/entities/Car.ts
  </files>
  <action>
Rewrite `Car.ts` to render paper cutout car shapes instead of rectangles.

**Car types (weighted random on construction):**
```typescript
type CarType = 'sedan' | 'suv' | 'pickup' | 'liftedTruck';

const CAR_TYPE_WEIGHTS: { type: CarType; weight: number }[] = [
  { type: 'sedan', weight: 0.45 },
  { type: 'suv', weight: 0.25 },
  { type: 'pickup', weight: 0.20 },
  { type: 'liftedTruck', weight: 0.10 },
];
```

**Each car type has a distinct top-down silhouette** defined as polygon points (relative to center 0,0):

- **Sedan**: Rounded body, compact. ~28x48px. Visible windows on sides, small trunk area.
- **SUV**: Wider body, longer. ~32x54px. Box-shaped rear, visible roof rack lines.
- **Pickup**: Distinct cab + bed separation. ~30x56px. Open bed area (lighter color fill).
- **Lifted Truck**: Like pickup but wider and taller-looking. ~34x58px. Aggressive stance, maybe bull bar at front.

**Drawing approach (per car, in constructor):**

1. Create a `Phaser.GameObjects.Graphics` for the car body
2. Draw drop shadow first using `drawPaperShadow()` ‚Äî offset rectangle matching car bounds
3. Draw the car body using `drawScissorCutPolygon()` with the car type's polygon points
4. Fill with a random color from `CAR_PAPER_COLORS`
5. Draw windows as lighter-colored interior shapes (slightly inset from body edges)
6. Draw wheels as small dark circles/rectangles at corners
7. Stroke outline with `PALETTE.markerBlack` at 2px ‚Äî the marker outline look
8. **Emoji face driver** ‚Äî render a face emoji (üòêüòäüò§üò†) as a Phaser Text centered on the car's windshield/cabin area
   - Pick randomly from a set: ['üòê','üòä','üò§','üò†','üôÇ','üòë']
   - Size: ~14-16px, centered in the car's upper area
   - This is the car's "occupant" ‚Äî no detailed person model, just the face
   - Emoji face is a child of the Container, moves with the car
9. Add this Graphics object to the Container

**Public properties to preserve:**
- Keep ALL existing public properties and methods (direction, lane, speed, hasBeenReached, hasPassed, isStopped)
- Keep ALL existing methods (update, isOffScreen, shouldStop, isPastStopLine, resetCar, getBounds)
- Add: `public carType: CarType` ‚Äî exposed so ReactionSystem can weight reactions based on car type

**resetCar changes:**
- On reset, re-roll car type and color (new car each time from the pool)
- Redraw the graphics for the new type

**Performance note:**
- Cars are drawn once at construction and on reset ‚Äî not every frame
- The Graphics object is part of the Container, moves with it ‚Äî no per-frame redraw needed

**Rotation handling:**
- Cars already face the right direction based on their lane's direction
- The polygon points should be defined for northbound (pointing up), then the Container rotation handles other directions
- Set rotation in constructor based on direction: north=0, south=PI, east=PI/2, west=-PI/2

**Coal roller smoke puffs (lifted truck only):**
- When a lifted truck is created, add a method `emitSmokePuff()` that creates 2-3 small gray paper cutout circles (crumpled paper look) behind the truck
- Smoke puffs: PALETTE.shadowDark at 0.3 alpha, ~8-12px circles, scissor-cut edges
- Animate: drift backward from truck + float up + fade out over 800ms
- Call `emitSmokePuff()` periodically (every ~500ms) in update() ONLY for liftedTruck type
- Puffs auto-destroy after animation

**Wind catch animation:**
- When a car enters the player's sign visibility cone (checked via existing ReactionSystem proximity), apply a brief 5-degree tilt-and-back tween:
  - `scene.tweens.add({ targets: this.container, angle: 5, duration: 150, yoyo: true })`
- Only trigger once per car pass (use a flag, reset on car reset)

**Do NOT change:**
- The update() movement logic
- The shouldStop() / isPastStopLine() traffic logic
- The getBounds() hitbox logic (keep using carWidth/carLength dimensions)
- The isOffScreen() check
  </action>
  <verify>
`npm run build` succeeds. Car.ts imports from paperArt and paletteConfig. CarType is exported. Each car type has distinct polygon points. Cars render with drop shadows and scissor-cut outlines.
  </verify>
  <done>
Cars render as 4 distinct paper cutout types with construction paper colors, hard drop shadows, scissor-cut outlines, and type-weighted random selection. All game logic preserved.
  </done>
</task>

</tasks>

<verification>
- Cars visually render as shaped paper cutouts (not rectangles)
- 4 distinct car types are visually distinguishable
- Each car has an emoji face driver visible in cabin area
- Cars use construction paper color palette (warm, muted tones)
- Each car has a hard-offset drop shadow (paper-on-table effect)
- Car outlines have scissor-cut imperfection (not perfectly straight)
- Lifted trucks emit gray paper smoke puffs behind them
- Cars do a brief 5-degree wind-catch tilt when entering player's visibility cone
- CarType is accessible as a public property on Car instances
- All existing car behavior (movement, stopping, off-screen cleanup) is unchanged
- No TypeScript errors, build succeeds
- No performance regression from more complex graphics (cars drawn once, not per frame)
</verification>

<success_criteria>
Cars look like paper cutouts on a craft table with distinct types, construction paper colors, and hard drop shadows.
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-ui-polish/09-02-SUMMARY.md`
</output>
