---
phase: 09-visual-ui-polish
plan: 04
type: execute
wave: 2
depends_on: ["09-01", "09-03"]
files_modified:
  - src/game/entities/Player.ts
  - src/game/scenes/IntersectionScene.ts
autonomous: true

must_haves:
  truths:
    - "Player character renders as a paper cutout person with head, body, and arms holding sign"
    - "Player has a hard-offset drop shadow (paper cutout on table)"
    - "Player has scissor-cut imperfect outline"
    - "Traffic lights render as paper cutouts on popsicle sticks"
    - "Active traffic light color glows through the paper (brighter, slight size pulse)"
    - "Inactive traffic light colors are muted/dim"
    - "Traffic light change triggers a brief visual emphasis (flash or pulse)"
  artifacts:
    - path: "src/game/entities/Player.ts"
      provides: "Paper cutout player character with drop shadow and scissor-cut outline"
    - path: "src/game/scenes/IntersectionScene.ts"
      provides: "Updated drawTrafficLights() with popsicle stick mounts and glow-through-paper effect"
  key_links:
    - from: "src/game/entities/Player.ts"
      to: "src/game/utils/paperArt.ts"
      via: "Uses drawPaperShadow, drawScissorCutPolygon for player rendering"
      pattern: "import.*paperArt"
    - from: "src/game/scenes/IntersectionScene.ts"
      to: "src/game/utils/paperArt.ts"
      via: "Uses drawPopsicleStick for traffic light poles"
      pattern: "drawPopsicleStick"
---

<objective>
Upgrade the player character and traffic lights to paper cutout aesthetic.

Purpose: The player character is the player's avatar — it needs to feel like a paper person holding a paper sign. Traffic lights are the core strategic element — light changes need to feel like an EVENT, not background furniture.

Output: Paper cutout player with drop shadow, and traffic lights on popsicle sticks with glow-through-paper effect.
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phase-9-design-direction.md
@mockups/paper-mario-style.html
@src/game/entities/Player.ts
@src/game/scenes/IntersectionScene.ts
@src/game/systems/TrafficLightSystem.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Player entity as paper cutout character</name>
  <files>
    src/game/entities/Player.ts
  </files>
  <action>
Rewrite Player.ts to render as a paper cutout person:

**Import paperArt utilities and PALETTE.**

**Paper person drawing (in constructor, using a Graphics object added to Container):**

Replace the existing rectangle/circle primitives with a Graphics-based procedural drawing:

1. **Drop shadow first** — draw the entire character silhouette offset by PALETTE.shadowOffsetX/Y in PALETTE.shadowDark at shadowAlpha

2. **Body** — simple paper cutout torso shape:
   - Rounded rectangle body in a muted blue (construction paper)
   - Scissor-cut edges via drawScissorCutPolygon

3. **Head** — circle in warm tone (PALETTE.safetyYellow or similar skin-warm paper color)
   - Marker-drawn eyes (two small dots)
   - Scissor-cut circle edge (slight wobble)

4. **Arms** — two small rectangle strips extending from body sides
   - One arm holds the sign post (angled toward sign)
   - Arms are separate Graphics children so they can potentially animate later

5. **Legs** — two small paper strips below body (darker shade)

6. **Sign post** — popsicle stick (drawPopsicleStick) extending up from the arm

7. **Sign board** — rectangle in material color with scissor-cut edges and drop shadow
   - Sign text rendered on top (keep existing text logic)

8. **Marker-style outline** — stroke entire character with PALETTE.markerBlack at 2px

**Preserve all existing public methods:**
- setSignMessage(message) — keep working
- setSignMaterial(material) — keep working
- setSignTexture(textureKey) — keep working (M2 crafted sign PNG)

**The character should be recognizable at game scale (~60-80px tall) as "person holding protest sign."**

**Arm crease at high fatigue:**
- In the Player's update method (or a new `updateVisuals()` called from update):
- When fatigue > 70%: draw a visible fold/crease line on the sign-holding arm at the elbow
  - Simple darker line across the arm rectangle at the midpoint
  - Gets more pronounced as fatigue increases (line gets thicker/darker)
- When fatigue > 85%: the arm angle visually droops (rotate arm child by 10-15 degrees)
- This is a subtle visual cue that your arm is giving out

**Idle wobble:**
- Apply `wobbleSine()` from paperArt to the player container in update():
  - Very subtle: amplitude 0.5 degrees, like paper catching the breeze
  - Only when NOT actively raising/lowering sign (idle state)
  </action>
  <verify>
`npm run build` succeeds. Player renders with paper cutout aesthetic. setSignMessage, setSignMaterial, and setSignTexture still work. Player has visible drop shadow and marker outline.
  </verify>
  <done>
Player character is a paper cutout person with head, body, arms, legs, sign post, and sign board. Has drop shadow, scissor-cut outline, and marker-style border.
  </done>
</task>

<task type="auto">
  <name>Task 2: Upgrade traffic lights to popsicle stick paper cutouts with glow effect</name>
  <files>
    src/game/scenes/IntersectionScene.ts
  </files>
  <action>
Rewrite the `drawTrafficLights()` method in IntersectionScene.ts:

**Traffic light rendering (each of the 4 lights):**

1. **Popsicle stick pole** — vertical stick from ground to light housing using `drawPopsicleStick()`

2. **Light housing** — paper cutout rectangle (dark, PALETTE.markerBlack) with scissor-cut edges
   - Contains 3 circular light positions

3. **Light circles:**
   - **Active light** (the current color): bright, full opacity, with a glow effect:
     - Draw a slightly larger circle behind the light in the light's color at 0.3 alpha (glow halo)
     - The light circle itself at full brightness
     - Brief size pulse on change (use a simple scale tween triggered by traffic light phase change)
   - **Inactive lights**: very dim (0.15 alpha), muted versions of their colors
   - "Glow through paper" effect: the active light looks like it's shining THROUGH construction paper — slightly warm/diffused

4. **Light change emphasis:**
   - Listen to `trafficLights.on('phaseChanged')` — already wired in create()
   - On phase change, trigger a brief camera flash effect:
     - Camera flash: `this.cameras.main.flash(150, 255, 255, 200, false, null, null, 0.1)` — very brief, very subtle white flash
   - Also scale-bounce the newly active lights (tween scale from 1.0 to 1.3 to 1.0 over 300ms)

5. **Drop shadow** on the traffic light housing (paper on table)

**Wire the phase change visual into the existing listener in create():**
- The `trafficLights.on('phaseChanged')` listener already exists — add the camera flash and light pulse tween calls inside it.

6. **Idle wobble on traffic lights:**
   - In the scene's update(), apply `wobbleSine()` to each traffic light container
   - Very subtle: amplitude 1 degree, like paper on a stick catching the wind

**Do NOT modify** any other methods in IntersectionScene. Only change drawTrafficLights(), add wobble in update(), and add 2-3 lines to the existing phaseChanged listener in create().
  </action>
  <verify>
`npm run build` succeeds. Traffic lights render with popsicle stick poles and paper cutout housings. Active lights glow brighter than inactive. Phase changes trigger a brief visual flash. No game logic changed.
  </verify>
  <done>
Traffic lights are paper cutouts on popsicle sticks with glow-through-paper active lights and camera flash on phase changes.
  </done>
</task>

</tasks>

<verification>
- Player character is recognizable as a paper person holding a sign
- Player has hard-offset drop shadow and scissor-cut outline
- Traffic lights sit on popsicle stick poles
- Active traffic light color is significantly brighter than inactive
- Traffic light change triggers a brief camera flash/pulse
- All existing Player methods (setSignMessage, setSignMaterial, setSignTexture) still work
- All existing traffic light game logic is unchanged
- No TypeScript errors, build succeeds
</verification>

<success_criteria>
Player looks like a paper cutout person on a craft table. Traffic light changes feel like an EVENT with visual emphasis.
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-ui-polish/09-04-SUMMARY.md`
</output>
