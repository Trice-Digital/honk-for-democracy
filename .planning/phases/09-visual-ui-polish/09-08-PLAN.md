---
phase: 09-visual-ui-polish
plan: 08
type: execute
wave: 3
depends_on: ["09-01", "09-05"]
files_modified:
  - src/game/scenes/IntersectionScene.ts
autonomous: true

must_haves:
  truths:
    - "Event dialogue UI is fully rebuilt with correct hitbox alignment"
    - "Dialogue panels are paper cutout style (cardboard background, scissor-cut edges, drop shadow)"
    - "Dialogue text uses Bangers font"
    - "Choice buttons are neobrutalist style matching HUD buttons"
    - "Mouseover/touch hitboxes align exactly with visible button boundaries"
    - "Dialogue speech bubbles match the paper speech bubble style from Plan 05"
  artifacts:
    - path: "src/game/scenes/IntersectionScene.ts"
      provides: "Rebuilt event dialogue UI with correct hitboxes and paper aesthetic"
  key_links:
    - from: "src/game/scenes/IntersectionScene.ts"
      to: "src/game/utils/paperArt.ts"
      via: "Uses paperArt for dialogue panel rendering"
      pattern: "import.*paperArt"
    - from: "src/game/scenes/IntersectionScene.ts"
      to: "src/game/config/paletteConfig.ts"
      via: "Uses PALETTE for dialogue colors"
      pattern: "import.*paletteConfig|PALETTE"
---

<objective>
Rebuild the event dialogue UI from scratch. The current implementation has hitboxes misaligned by ~300px from visual elements. This is not a fix — it's a full redo with paper craft aesthetic.

Purpose: Events (cop check, counter-protester, karma moment) are key gameplay moments. The dialogue UI must work correctly AND match the paper world.

Output: Rebuilt event dialogue with correct hitboxes and paper cutout styling.
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phase-9-design-direction.md
@mockups/paper-mario-style.html
@src/game/scenes/IntersectionScene.ts
@src/game/systems/EventSystem.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild event dialogue UI with paper aesthetic and correct hitboxes</name>
  <files>
    src/game/scenes/IntersectionScene.ts
  </files>
  <action>
Find the existing event dialogue methods in IntersectionScene.ts (likely `showEventDialogue()`, `showEventChoice()`, or similar) and REBUILD them entirely.

**The core problem:** Current hitboxes are ~300px off from the visual elements. This means click/touch targets don't match what the player sees. Root cause is likely incorrect coordinate calculation (not accounting for camera scroll, or using wrong parent container coordinates).

**Rebuild approach:**

1. **Dialogue panel** — paper cutout cardboard panel:
   - Use `PALETTE.cardboard` fill with `drawScissorCutRect` for edges
   - Hard offset drop shadow (PALETTE.shadowDark)
   - Marker-style border (PALETTE.markerBlack, 3px)
   - Position: center-bottom of viewport (above action buttons)
   - scrollFactor(0) — FIXED to camera, not to world. This is likely the original hitbox bug.
   - depth: 150 (above gameplay, below menu overlay)

2. **Speaker name/icon** — paper cutout badge:
   - Small paper rectangle with the speaker label (e.g., "COP", "COUNTER-PROTESTER", "BYSTANDER")
   - Bangers font, white on dark badge
   - Positioned at top-left of dialogue panel

3. **Dialogue text:**
   - Bangers font, PALETTE.markerBlack on cardboard
   - Word-wrapped within panel width
   - Slightly smaller than HUD text (~18px)

4. **Choice buttons** — neobrutalist, matching Plan 05 HUD buttons:
   - Thick border, hard offset shadow, press-into-shadow on pointerdown
   - Each button is a Phaser Container with:
     - Graphics background (the button shape)
     - Text child (the label)
     - setInteractive() on the GRAPHICS object with correct hitArea matching the visual bounds
   - **CRITICAL:** Use `setInteractive(new Phaser.Geom.Rectangle(0, 0, width, height), Phaser.Geom.Rectangle.Contains)` with explicit hit area matching the drawn rectangle
   - scrollFactor(0) on the entire dialogue container

5. **Hitbox verification approach:**
   - All interactive elements use explicit `Phaser.Geom.Rectangle` hit areas
   - All elements are children of a single Container with scrollFactor(0)
   - NO reliance on automatic bounds detection
   - Test: button pointerover should highlight when mouse is visually over the button

6. **Show/hide:**
   - `showEventDialogue(event)`: create the panel, populate text and choices from event config
   - Each choice button's pointerdown calls the event's choice handler then destroys the dialogue
   - While dialogue is showing, gameplay continues (don't pause — events are part of the action)

**Do NOT change:**
- EventSystem.ts logic (event triggering, timing, effects)
- Event configuration/content
- Only rebuild the visual rendering and interaction layer
  </action>
  <verify>
`npm run build` succeeds. Event dialogue renders as a paper cutout panel with neobrutalist choice buttons. Click/touch targets align exactly with visible button boundaries (no 300px offset). Dialogue text uses Bangers font. All events still trigger and resolve correctly.
  </verify>
  <done>
Event dialogue UI fully rebuilt: paper cutout cardboard panel, Bangers font, neobrutalist choice buttons, explicit hit areas with correct alignment. The 300px hitbox bug is eliminated by using scrollFactor(0) containers with explicit Phaser.Geom.Rectangle hit areas.
  </done>
</task>

</tasks>

<verification>
- Event dialogue appears when events trigger
- Dialogue panel has paper cutout aesthetic (cardboard, scissor edges, drop shadow)
- Choice buttons have neobrutalist style matching HUD buttons
- Click/touch targets align with visible button boundaries (no offset)
- Dialogue text uses Bangers font
- Events resolve correctly when choices are made
- No TypeScript errors, build succeeds
</verification>

<success_criteria>
Event dialogue works correctly (hitboxes aligned) and matches the paper craft world aesthetic.
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-ui-polish/09-08-SUMMARY.md`
</output>
