---
phase: 09-visual-ui-polish
plan: 06
type: execute
wave: 3
depends_on: ["09-01", "09-05"]
files_modified:
  - src/game/scenes/IntersectionScene.ts
  - src/game/systems/WeatherSystem.ts
autonomous: true

must_haves:
  truths:
    - "A paper cutout analog clock displays game time (10:00 AM to 12:00 PM over session duration)"
    - "Clock has marker-drawn face, popsicle stick mount, and hour/minute hands that animate"
    - "An in-game menu button exists in the corner (gear or hamburger icon, paper cutout style)"
    - "Menu button opens an overlay with Restart and Quit to Title options"
    - "Rain visual upgraded: paper teardrop cutouts falling instead of line streaks"
    - "Rain adds a blue color tint overlay (like blue construction paper vellum)"
    - "Weather overlay does not obstruct gameplay visibility"
  artifacts:
    - path: "src/game/scenes/IntersectionScene.ts"
      provides: "Paper clock UI, menu button with overlay, updated weather visual integration"
    - path: "src/game/systems/WeatherSystem.ts"
      provides: "Paper teardrop rain particles and blue vellum overlay"
  key_links:
    - from: "src/game/scenes/IntersectionScene.ts"
      to: "src/game/utils/paperArt.ts"
      via: "Uses drawPopsicleStick, drawScissorCutRect for clock and menu"
      pattern: "import.*paperArt"
    - from: "src/game/systems/WeatherSystem.ts"
      to: "src/game/config/paletteConfig.ts"
      via: "Uses PALETTE for rain overlay colors"
      pattern: "import.*paletteConfig|PALETTE"
---

<objective>
Add the in-game paper clock, menu button, and upgrade weather overlays to paper aesthetic.

Purpose: The clock replaces/supplements the numeric timer with a craft-world analog clock. The menu button gives players control without obstructing gameplay. Paper rain replaces digital line streaks.

Output: Paper cutout clock, functional menu overlay, and paper teardrop rain particles.
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phase-9-design-direction.md
@mockups/paper-mario-style.html
@src/game/scenes/IntersectionScene.ts
@src/game/systems/WeatherSystem.ts
@src/game/config/intersectionConfig.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add paper cutout analog clock to HUD</name>
  <files>
    src/game/scenes/IntersectionScene.ts
  </files>
  <action>
Add a paper cutout analog clock to the IntersectionScene HUD:

**Clock design (paper cutout style):**

Create a new method `createClockUI()` called from `createUI()`:

1. **Clock face** — circle (~50px radius) in PALETTE.paperWhite
   - Scissor-cut edge (slight wobble on the circle)
   - Hard offset drop shadow
   - Marker-drawn border (PALETTE.markerBlack, 2px)
   - 12 marker tick marks around the edge (small lines at hour positions)
   - "12", "3", "6", "9" marker text in tiny font (Bangers, 8px)

2. **Popsicle stick mount** — small stick below the clock (drawPopsicleStick)

3. **Clock hands:**
   - Hour hand: short, thick (3px), PALETTE.markerBlack
   - Minute hand: longer, thinner (2px), PALETTE.markerBlack
   - Both are Phaser Graphics lines that rotate

4. **Position:** Top-center of screen, between score and timer (or replacing the numeric timer)
   - Actually: keep the numeric timer AND add the clock for now. Place clock at top-center.
   - scrollFactor(0), depth 100

5. **Time mapping:**
   - Game session is 180 seconds (configurable via this.config.sessionDuration)
   - Map to 10:00 AM → 12:00 PM (2 hours)
   - `gameProgress = 1 - (timeRemaining / sessionDuration)` → 0.0 to 1.0
   - Hour hand: from 10 o'clock position to 12 o'clock position (300 degrees → 360 degrees, covering 60 degrees)
   - Minute hand: 2 full rotations (0 → 720 degrees)
   - Convert to radians for Phaser rotation

Create a new method `updateClock()` called from `updateUI()`:
- Read `state.timeRemaining` and `state.sessionDuration`
- Calculate hand angles and update the Graphics rotation
- Redraw the hand lines at new angles each frame
  </action>
  <verify>
`npm run build` succeeds. Clock renders in paper cutout style at top-center. Hands animate from 10:00 to 12:00 over the game session. Numeric timer still exists alongside.
  </verify>
  <done>
Paper cutout analog clock displays at top-center with marker-drawn face, popsicle stick mount, and hands animating from 10:00 AM to 12:00 PM over game duration.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add in-game menu button with overlay</name>
  <files>
    src/game/scenes/IntersectionScene.ts
  </files>
  <action>
Add a menu button and overlay to IntersectionScene:

**Menu button (paper cutout gear icon):**

Create `createMenuButton()` called from `createUI()`:

1. Small paper cutout button (36x36px) in top-left corner (below score text area)
   - Draw a simple gear shape OR three horizontal lines (hamburger) using Graphics
   - Paper cutout style: scissor-cut edges, drop shadow, marker border
   - scrollFactor(0), depth 105
   - Interactive: on pointerdown → toggle menu overlay

**Menu overlay:**

Create `toggleMenuOverlay()`:

1. Creates (or destroys) a menu overlay:
   - Semi-transparent dark background (0x000000, alpha 0.6) covering full viewport
   - Paper cutout panel in center (~240x200px) with PALETTE.cardboard fill, scissor-cut edges, drop shadow
   - Title: "PAUSED" in Bangers font, PALETTE.safetyYellow

2. **Buttons (neobrutalist style, matching HUD buttons):**
   - "Resume" — PALETTE.stoplightGreen fill. Closes overlay.
   - "Restart" — PALETTE.actionBlue fill. Calls `this.scene.restart()`.
   - "Quit to Title" — PALETTE.stoplightRed fill. Calls `this.scene.start('BootScene')` or navigates to landing page.

3. While menu is open:
   - Pause game time (set a flag checked by update() — skip all system updates while paused)
   - Or use Phaser's `this.scene.pause()` / `this.scene.resume()` if simpler

4. scrollFactor(0), depth 500 (above everything)

**IMPORTANT:** Keep the menu simple. 3 buttons, paper panel, that's it. Don't over-engineer.

**Pause integration:**
- Add a `private isPaused: boolean = false` flag
- In `update()`: if isPaused, return early (skip all systems)
- Menu Resume button sets isPaused = false and destroys overlay
- Menu button sets isPaused = true and creates overlay
  </action>
  <verify>
`npm run build` succeeds. Menu button visible in corner. Clicking opens paper panel overlay with Resume, Restart, Quit options. Game pauses while menu is open. Resume closes overlay and unpauses.
  </verify>
  <done>
In-game menu button opens a paper cutout pause overlay with Resume, Restart, and Quit to Title options. Game pauses while menu is open.
  </done>
</task>

<task type="auto">
  <name>Task 3: Upgrade rain to paper teardrop cutouts with blue vellum overlay</name>
  <files>
    src/game/systems/WeatherSystem.ts
  </files>
  <action>
Upgrade the rain visual in WeatherSystem.ts:

**Paper teardrop rain particles (replace line streaks):**

Update `createRainVisual()` and `updateRainVisual()`:

1. Rain drops are now teardrop shapes, not lines:
   - Each drop: small teardrop (~6x10px) drawn as a filled path
   - Teardrop shape: circle at bottom + pointed top (like a paper cutout raindrop)
   - Color: blue-ish (0x6699cc) at 0.4 alpha — looks like blue construction paper cutouts
   - Each drop has a very subtle darker border (1px stroke)

2. Drop movement unchanged (fall speed, wind angle, wrap-around)

3. **Blue vellum overlay:**
   - Replace the dark `#000022` overlay with a blue tint overlay
   - Color: 0x3366aa at 0.08 alpha — desaturated blue, like a sheet of blue vellum paper laid over the scene
   - This creates the "rainy day" color grading from the design spec

4. Import PALETTE from paletteConfig for consistent colors

**Do NOT change:**
- Rain timing/duration logic
- Sign degradation logic
- NPC leaving logic
- Confidence drain logic
- startRain() / stopRain() control flow
  </action>
  <verify>
`npm run build` succeeds. Rain particles are teardrop shapes instead of lines. Blue vellum overlay tints the scene during rain. Rain visual does not obstruct gameplay.
  </verify>
  <done>
Rain renders as paper teardrop cutouts falling with a blue vellum overlay tint. All rain game logic unchanged.
  </done>
</task>

</tasks>

<verification>
- Paper analog clock displays at top-center with animating hands (10 AM → 12 PM)
- Clock has paper cutout aesthetic (scissor edges, drop shadow, popsicle mount)
- Menu button is visible and accessible in corner
- Menu overlay pauses game and offers Resume, Restart, Quit
- Menu panel has paper cutout style (cardboard, scissor edges, marker border)
- Rain particles are paper teardrop shapes (not line streaks)
- Rain adds blue vellum color tint overlay
- No game logic changes beyond pause/resume
- No TypeScript errors, build succeeds
</verification>

<success_criteria>
Clock and menu add visual richness and player control. Rain feels like paper teardrops on a craft table.
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-ui-polish/09-06-SUMMARY.md`
</output>
