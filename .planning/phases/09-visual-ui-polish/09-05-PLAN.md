---
phase: 09-visual-ui-polish
plan: 05
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/game/scenes/IntersectionScene.ts
autonomous: true

must_haves:
  truths:
    - "Reaction feedback displays in paper speech bubbles (not plain floating text)"
    - "Speech bubbles have scissor-cut edges and paper drop shadows"
    - "Positive reactions use warm colors, negative use red/gray tones"
    - "Score floaters have marker-font styling with slight bounce on appear"
    - "HUD bars (confidence, fatigue) have paper texture fills and neobrutalist styling"
    - "Action buttons (Raise, Switch Arms, Rest) have neobrutalist style: chunky, hard black shadows, high contrast"
    - "Score text and timer use marker-style font treatment (bold, slight stroke)"
    - "Fatigue bar color-codes to traffic light hint: green during red lights, yellow during green lights"
  artifacts:
    - path: "src/game/scenes/IntersectionScene.ts"
      provides: "Updated showReactionFeedback, createUI, updateUI with paper aesthetic"
  key_links:
    - from: "src/game/scenes/IntersectionScene.ts"
      to: "src/game/utils/paperArt.ts"
      via: "Uses paperArt for speech bubbles, button shadows, bar textures"
      pattern: "import.*paperArt"
    - from: "src/game/scenes/IntersectionScene.ts"
      to: "src/game/config/paletteConfig.ts"
      via: "Uses PALETTE for consistent HUD colors"
      pattern: "import.*paletteConfig|PALETTE"
---

<objective>
Polish all reaction feedback and HUD elements to match the Paper Mario Protest aesthetic.

Purpose: The HUD and reactions are what players see constantly during gameplay. Neobrutalist buttons, paper speech bubbles, and marker-font text create visual cohesion with the craft table world.

Output: Reaction speech bubbles, HUD bars, and action buttons all reskinned with paper craft aesthetics.
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phase-9-design-direction.md
@mockups/paper-mario-style.html
@src/game/scenes/IntersectionScene.ts
@src/game/systems/TrafficLightSystem.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Paper speech bubble reactions and marker-font score floaters</name>
  <files>
    src/game/scenes/IntersectionScene.ts
  </files>
  <action>
Rewrite `showReactionFeedback()` in IntersectionScene.ts:

**Paper speech bubble for emoji reaction:**

Instead of a plain floating emoji text, render a speech bubble:

1. Create a Graphics object for the bubble background:
   - Draw a rounded rectangle (paper cutout style) with scissor-cut edges
   - Background color: `PALETTE.paperWhite` for positive/neutral, tinted red for negative
   - Hard offset drop shadow behind the bubble
   - Small triangle "tail" pointing down toward the car
   - Marker-style border (PALETTE.markerBlack, 2px stroke)

2. Place the emoji text INSIDE the bubble (centered)

3. Animate: float up + slight wobble rotation (paper catching the wind) + fade out
   - Use wobbleSine for a gentle rotation oscillation during the float
   - Tween: y moves up 80px, alpha fades to 0, duration 1400ms
   - Add slight x drift (random -20 to +20) to simulate paper flutter

4. Cleanup: destroy both Graphics and Text on tween complete

**Marker-font score floaters:**

- Use fontFamily `'Permanent Marker', cursive` (already loaded for sign creator)
- Larger font size for bonus/deflect (28px vs 22px)
- Add a brief scale-bounce on appear: scale from 0.5 to 1.1 to 1.0 over 200ms
- Stroke with PALETTE.markerBlack at 3px
- Positive: PALETTE.stoplightGreen, Negative: PALETTE.stoplightRed

**Do NOT change the reaction logic** — only the visual rendering in showReactionFeedback.
  </action>
  <verify>
`npm run build` succeeds. Reactions display in paper speech bubbles. Score floaters use marker-font styling. Reactions animate with paper flutter.
  </verify>
  <done>
Reactions show in paper speech bubbles with scissor-cut edges and drop shadows. Score floaters use Permanent Marker font with bounce animation. Paper flutter on float-away.
  </done>
</task>

<task type="auto">
  <name>Task 2: Neobrutalist HUD bars and action buttons</name>
  <files>
    src/game/scenes/IntersectionScene.ts
  </files>
  <action>
Update `createUI()`, `createConfidenceUI()`, `createFatigueUI()`, `createActionButtons()`, and `updateUI()`:

**Neobrutalist button style (all action buttons):**
- Thick (3-4px) solid PALETTE.markerBlack border
- Hard offset shadow (3px right, 3px down) in PALETTE.markerBlack
- No rounded corners (or very slight 4px radius)
- High contrast: bright fill colors against dark shadow
- On pointerdown: translate +2px right, +2px down (press into the shadow) and reduce shadow
- On pointerup: restore position and shadow

Apply to: Raise button, Switch Arms button, Rest button, Mute button

**Confidence and Fatigue bars:**
- Bar background: paper-textured rectangle (PALETTE.cardboard with slight texture via a few horizontal grain lines)
- Bar border: 2px PALETTE.markerBlack (marker drawn border)
- Bar fill: same color logic as current, but slightly muted/paper-like versions
- Hard offset shadow on the bar background
- Labels: use `'Permanent Marker', cursive` fontFamily

**Score text and timer:**
- Font: `'Permanent Marker', cursive`
- Larger size (32px for score, 30px for timer)
- Stroke: PALETTE.markerBlack at 4px (thick marker outline)
- Score: PALETTE.safetyYellow color
- Timer: PALETTE.paperWhite color (red flash when low, keep existing logic)

**Fatigue bar traffic light hint (design spec feature):**
In `updateUI()`, add fatigue bar strategic coloring:
- When traffic is RED (cars stopped): fatigue bar border turns green — visual hint "push now, raise sign"
- When traffic is GREEN (cars flowing): fatigue bar border turns yellow — visual hint "conserve"
- Check `this.trafficLights.getGreenDirections()` — if empty or all-red phase, it's "push now"
- This is subtle — just the bar border color changes, not the fill

**Do NOT change:**
- Any game logic in updateUI
- The confidence/fatigue calculation logic
- Button click handlers (only change visual appearance)
  </action>
  <verify>
`npm run build` succeeds. Buttons have neobrutalist style with hard shadows. Bars have paper texture and marker borders. Score/timer use marker font. Fatigue bar border color-codes to traffic phase.
  </verify>
  <done>
HUD is fully reskinned: neobrutalist buttons with hard shadows, paper-textured bars with marker borders, marker-font score/timer, and traffic-light-synced fatigue bar hint.
  </done>
</task>

</tasks>

<verification>
- Reactions display in paper speech bubbles (not plain floating text)
- Speech bubbles have drop shadows, scissor-cut edges, marker borders
- Score floaters use Permanent Marker font with bounce animation
- Action buttons have neobrutalist style (thick borders, hard shadows, press effect)
- Confidence/fatigue bars have paper texture and marker-style borders
- Score and timer use marker-style font
- Fatigue bar border subtly color-codes to traffic phase (green = push, yellow = conserve)
- No game logic changed
- No TypeScript errors, build succeeds
</verification>

<success_criteria>
All HUD elements feel like they belong on the same craft table. Reactions feel like paper notes fluttering in the wind.
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-ui-polish/09-05-SUMMARY.md`
</output>
