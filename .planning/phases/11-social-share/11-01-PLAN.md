---
phase: 11-social-share
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/ShareCardGenerator.ts
  - src/game/config/shareConfig.ts
autonomous: true

must_haves:
  truths:
    - "ShareCardGenerator produces a 1080x1080 PNG data URL from sign image + score + grade + intersection name"
    - "Share card matches Paper Mario protest aesthetic: construction paper texture, Polaroid layout, tape accent, stencil font"
    - "Share card is generated entirely client-side using Canvas API with zero external dependencies"
  artifacts:
    - path: "src/game/config/shareConfig.ts"
      provides: "Share card layout constants, text templates, color palette references"
    - path: "src/lib/ShareCardGenerator.ts"
      provides: "Canvas-based share image generator"
      exports: ["generateShareCard"]
  key_links:
    - from: "src/lib/ShareCardGenerator.ts"
      to: "Canvas API"
      via: "document.createElement('canvas'), ctx.drawImage, canvas.toDataURL"
      pattern: "canvas\\.toDataURL"
---

<objective>
Build the ShareCardGenerator — a pure TypeScript class that composites a 1080x1080 Polaroid-style share card using the HTML Canvas API.

Purpose: This is the core image generation engine for social sharing. It takes the player's sign PNG, score, grade, and intersection name and produces a shareable image that matches the Paper Mario protest aesthetic. Zero dependencies — just Canvas API.

Output: ShareCardGenerator class + shareConfig constants
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phase-9-design-direction.md
@src/game/config/paletteConfig.ts
@src/game/config/scoreConfig.ts
@src/game/config/signConfig.ts
@src/game/utils/paperArt.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Share card config and layout constants</name>
  <files>src/game/config/shareConfig.ts</files>
  <action>
Create shareConfig.ts with all share card layout constants:

**Canvas dimensions:**
- SHARE_CARD_WIDTH = 1080
- SHARE_CARD_HEIGHT = 1080

**Polaroid layout zones (all in pixels at 1080x1080):**
- Background: full canvas, cardboard color (#c5a059) with paper grain
- Polaroid frame: white (#f5f0e8) rectangle inset ~60px from edges, with 3px black (#1a1a1a) border and hard-offset drop shadow (3px right, 3px down, #2a2a2a at 35% alpha)
- Sign image area: centered in top 55% of Polaroid frame, max 800x500, preserving aspect ratio
- Caption area: below sign image, centered
- Score area: below caption
- Branding area: bottom of Polaroid frame

**Text config:**
- Caption text: "I stood my ground at [Intersection Name]" — use Bangers font, 42px, color #1a1a1a
- Score display: "[Grade] [Score] pts" — Bangers font, 56px, grade uses its color from scoreConfig
- Branding: "HonkForDemocracy.org" — Bangers font, 36px, color #3b82f6 (actionBlue)

**Tape accent config:**
- Position: top-right corner of Polaroid frame, rotated ~15 degrees
- Color: semi-transparent off-white (#f0ead6 at 55% alpha)
- Size: ~120x30px rectangle with slightly ragged edges

**Intersection name** (hardcoded for MVP since there's only one map):
- DEFAULT_INTERSECTION_NAME = "The Corner"

Export all as const object SHARE_CONFIG.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit src/game/config/shareConfig.ts</verify>
  <done>shareConfig.ts exports SHARE_CONFIG with all layout constants for 1080x1080 Polaroid card</done>
</task>

<task type="auto">
  <name>Task 2: ShareCardGenerator — Canvas API image compositor</name>
  <files>src/lib/ShareCardGenerator.ts</files>
  <action>
Create ShareCardGenerator.ts in src/lib/ (pure TypeScript, no Phaser dependency — follows Phase 8 architectural boundary pattern).

**Class: ShareCardGenerator**

Export a single async function: `generateShareCard(options: ShareCardOptions): Promise<string>`

ShareCardOptions interface:
```typescript
interface ShareCardOptions {
  signImageDataUrl: string;    // PNG from Fabric.js sign creator
  score: number;               // Final game score
  gradeLabel: string;          // e.g., "A", "S", "B"
  gradeColor: string;          // Hex color for grade
  intersectionName?: string;   // Defaults to SHARE_CONFIG.defaultIntersectionName
}
```

**Implementation steps (all Canvas 2D API):**

1. Create offscreen canvas (1080x1080)
2. **Draw background:** Fill with cardboard color (#c5a059). Draw procedural paper grain over entire canvas — port the grain logic from paperArt.ts but adapted for Canvas 2D (random short lines + dots at low opacity). Use approximately the same density as the Phaser version.
3. **Draw Polaroid frame:** White (#f5f0e8) rounded rectangle with 3px #1a1a1a stroke. Hard-offset shadow behind it (draw shadow rect first at +3,+3 offset, #2a2a2a at 0.35 alpha). Frame inset ~60px from canvas edges, so frame is ~960x960.
4. **Draw sign image:** Load the signImageDataUrl into an Image element (await load). Draw centered in top portion of frame, max width 800px, max height 500px, preserving aspect ratio. Add a thin 2px dark border around the sign image for definition.
5. **Draw tape accent:** Top-right corner of frame. Draw a rotated semi-transparent rectangle (~120x30px) with slightly wobbly edges (2-3 random vertex offsets, same idea as paperArt wobbleEdge). Color: #f0ead6 at 55% alpha. Rotate canvas context ~15 degrees for the tape angle.
6. **Draw caption text:** "I stood my ground at {intersectionName}" — centered below sign image. Use Bangers font at 42px. Color #1a1a1a. If text is too wide, reduce font size. Use ctx.measureText for width checks.
7. **Draw score:** Grade letter in a filled circle (grade color) with black stroke, followed by score number + "pts". Bangers font, 56px for grade, 48px for score number. Centered below caption.
8. **Draw branding:** "HonkForDemocracy.org" at bottom of frame. Bangers font, 36px, color #3b82f6. Centered.
9. **Return canvas.toDataURL('image/png')**

**Font handling:** Bangers is already loaded via Google Fonts CDN in Layout.astro. Use `document.fonts.ready` promise before drawing text to ensure font is available. Fallback to 'Impact, sans-serif' if Bangers not loaded.

**Error handling:** If sign image fails to load, draw a placeholder rectangle with "YOUR SIGN" text. Wrap entire function in try/catch, return empty string on failure with console.error.

IMPORTANT: This file lives in src/lib/ (NOT src/game/) because it's pure DOM/Canvas code with no Phaser dependency, following the same architectural boundary as SignEditor.ts from Phase 8.
  </action>
  <verify>
- TypeScript compiles: npx tsc --noEmit src/lib/ShareCardGenerator.ts
- Verify exports: grep "export.*generateShareCard" src/lib/ShareCardGenerator.ts
  </verify>
  <done>generateShareCard() produces a 1080x1080 PNG data URL with Polaroid layout, paper texture, sign image, score/grade, caption, tape accent, and branding — all via Canvas API with zero external dependencies</done>
</task>

</tasks>

<verification>
- shareConfig.ts exports SHARE_CONFIG with all layout dimensions
- ShareCardGenerator.ts exports generateShareCard async function
- No Phaser imports in ShareCardGenerator.ts (pure DOM/Canvas)
- No external dependencies added to package.json
- TypeScript compiles cleanly
</verification>

<success_criteria>
- generateShareCard() accepts sign image data URL + score data and returns a PNG data URL
- Output is 1080x1080 pixels (social media optimized)
- Card has Polaroid layout: white frame, sign image, caption, score, branding, tape accent
- Paper grain texture on background matches the project aesthetic
- All text uses Bangers font with fallback
</success_criteria>

<output>
After completion, create `.planning/phases/11-social-share/11-01-SUMMARY.md`
</output>
