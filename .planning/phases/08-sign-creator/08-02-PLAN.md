---
phase: 08-sign-creator
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/lib/signDecorations.ts
  - src/lib/signEditor.ts
autonomous: true

must_haves:
  truths:
    - "Player can add at least 3 types of decorative elements to their sign"
    - "Decorations are draggable and positionable on the sign canvas"
    - "Player can remove a decoration after placing it"
    - "Decorations export correctly as part of the PNG data URL"
  artifacts:
    - path: "src/lib/signDecorations.ts"
      provides: "SVG decoration/sticker definitions and rendering"
      min_lines: 80
    - path: "src/lib/signEditor.ts"
      provides: "Updated SignEditor with addDecoration and removeDecoration methods"
  key_links:
    - from: "src/lib/signDecorations.ts"
      to: "src/lib/signEditor.ts"
      via: "Decoration SVGs added as FabricImage objects to canvas"
      pattern: "addDecoration|FabricImage.fromURL"
    - from: "src/lib/signEditor.ts"
      to: "fabric"
      via: "Fabric.js canvas manages decoration objects alongside text"
      pattern: "canvas.add|canvas.remove"
---

<objective>
Add decorative elements (stickers, tape, glitter accents) to the Fabric.js sign editor so players can embellish their signs.

Purpose: Decorations are what make the sign creator feel like arts & crafts, not a form. Stickers, tape borders, and drawn accents let players express personality. This is the "fun" layer.

Output: A decoration system with SVG-based stickers/decorations that can be dragged onto the sign canvas, repositioned, and removed.
</objective>

<execution_context>
@/home/scott/.claude/get-shit-done/workflows/execute-plan.md
@/home/scott/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/signEditor.ts
@src/game/config/signConfig.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create decoration/sticker system with SVG definitions</name>
  <files>
    src/lib/signDecorations.ts
  </files>
  <action>
Create `src/lib/signDecorations.ts` — SVG-based decorative elements for the sign:

**Decoration categories (at least 3 types per requirement SIGN-13):**

1. **Stickers** — Small SVG shapes placed on the sign:
   - Peace sign (circle with lines)
   - Heart (SVG path heart shape)
   - Star (5-pointed star)
   - Fist (raised fist — protest solidarity)
   - Megaphone (amplify your voice)
   - Smiley face

2. **Tape accents** — Rectangular strips that look like duct tape or washi tape:
   - Duct tape strip (silver, slight texture)
   - Washi tape strip (patterned, colorful)
   - Masking tape strip (beige, torn edges)

3. **Drawn accents** — Hand-drawn SVG flourishes:
   - Drawn stars (sketchy, not perfect)
   - Drawn hearts (hand-drawn style)
   - Drawn arrows (pointing, emphasis)
   - Drawn underline (wavy)
   - Exclamation marks cluster

**Each decoration is defined as:**
```typescript
interface DecorationDef {
  id: string;
  category: 'sticker' | 'tape' | 'drawn';
  label: string;
  svgString: string;  // Inline SVG markup
  defaultWidth: number;
  defaultHeight: number;
}
```

Export `DECORATIONS: DecorationDef[]` array with all decoration definitions.

Export `getDecorationsByCategory(category: string): DecorationDef[]` helper.

SVGs should be simple, clean, single-color (the fill color can be parameterized). Keep SVGs inline as template strings — no external files. Each SVG should be recognizable at 40x40px size on mobile.
  </action>
  <verify>
`npm run build` succeeds. `DECORATIONS` array has at least 10 entries across 3 categories. Each decoration has a valid `svgString`.
  </verify>
  <done>
DecorationDef interface and DECORATIONS array exist with stickers, tape accents, and drawn accents. At least 3 items per category (stickers, tape, drawn).
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire decorations into SignEditor with add/remove/drag</name>
  <files>
    src/lib/signEditor.ts
  </files>
  <action>
Update `SignEditor` class to support decorations:

**`addDecoration(decoration: DecorationDef): void`**
1. Convert the SVG string to a data URL: `'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(decoration.svgString)`
2. Use `fabric.FabricImage.fromURL(dataUrl)` to create a Fabric.js image object
3. Set initial position (centered on canvas), scale to `defaultWidth`/`defaultHeight`
4. Make it selectable, draggable (Fabric.js defaults handle this)
5. Add a custom property `decorationId` to track which decoration it is
6. Add to canvas via `canvas.add(imageObj)`
7. Track added decorations in an internal array for `getDecorations()` method

**`removeSelected(): void`**
1. Get `canvas.getActiveObject()`
2. If it's a decoration (has `decorationId` property), remove it from canvas and internal tracking
3. If it's the text object, do NOT remove it (text is always present)

**`getDecorations(): string[]`**
- Return array of decoration IDs currently on the canvas (for storing in SignData)

**Canvas interaction rules:**
- Text object: draggable YES, deletable NO, resizable NO (font size controlled by picker)
- Decoration objects: draggable YES, deletable YES (via removeSelected), resizable YES (corner handles)
- Disable rotation on all objects (`lockRotation: true` or `hasRotatingPoint: false` in Fabric.js v6) — keep it simple, not a full design tool
- Set `cornerSize: 20` and `touchCornerSize: 40` for mobile-friendly resize handles

**Export correctness:**
- When `canvas.toDataURL()` is called, ALL objects (text + decorations + background) render into the PNG automatically — this is Fabric.js default behavior, no special handling needed
- Verify: the decoration objects are part of the canvas object tree and will be included in export
  </action>
  <verify>
`npm run build` succeeds. SignEditor has `addDecoration`, `removeSelected`, and `getDecorations` methods. Decorations load from SVG data URLs, are draggable, and export as part of `canvas.toDataURL()`.
  </verify>
  <done>
Decorations can be added to the Fabric.js canvas as draggable/resizable objects. They can be removed via removeSelected. They export correctly in the PNG data URL. Rotation is disabled for simplicity.
  </done>
</task>

</tasks>

<verification>
- At least 3 decoration categories with multiple items each
- Decorations render correctly on the Fabric.js canvas from SVG
- Decorations are draggable and resizable on mobile (large touch targets)
- Text object cannot be deleted, only decorations can be removed
- Rotation is disabled on all objects (not a full design tool)
- toDataURL export includes all decorations in the PNG
- No TypeScript errors, build succeeds
</verification>

<success_criteria>
Player can add stickers, tape accents, and drawn accents to their sign. Decorations are draggable, resizable, and removable. All decorations export correctly in the PNG data URL.
</success_criteria>

<output>
After completion, create `.planning/phases/08-sign-creator/08-02-SUMMARY.md`
</output>
